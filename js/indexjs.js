$(function(){function AllJq(){var u=navigator.userAgent;var f=u.indexOf('Android')>-1||u.indexOf('Adr')>-1;var g=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(g==true){setupWebViewJavascriptBridge(function(d){var e="";d.callHandler('JSTOOC',{'getUserInfo':'value'},function responseCallback(a){console.log("JS received response:",a)})d.registerHandler('OCTOJS',function(a,b){console.log("JS Echo called with:",a)b(a)if(a.UserName&&a.PassWord){e=a.UserName;passWordNum=a.PassWord;PeopleInfo=a.type;GetToken(a.UserName,a.PassWord,a.type);var c=GetToken(a.UserName,a.PassWord,a.type);GetIndexIcon(c);GetPointLotteryList(c);sessionStorage.setItem('UserName',e);sessionStorage.setItem('PassWord',passWordNum);sessionStorage.setItem('LoginType',PeopleInfo);sessionStorage.setItem('Access_token',c)}})})}else if(f==true){var h=window.AndroidWebView.getUserInfo();var i=eval('('+h+')');GetToken(i.uname,i.pwd,i.type);var j=GetToken(i.uname,i.pwd,i.type);GetIndexIcon(j);GetPointLotteryList(j);$('#BackToApps').on('click',function(){window.AndroidWebView.goBack()});sessionStorage.setItem('UserName',i.uname);sessionStorage.setItem('PassWord',i.pwd);sessionStorage.setItem('LoginType',i.type);sessionStorage.setItem('Access_token',j)}}AllJq();document.getElementById("BackToApps").addEventListener('click',function(){setupWebViewJavascriptBridge(function(b){b.callHandler('JSTOOC',{'BackToApps':'noData'},function(a){console.log('JS got response',a)})})})});function setupWebViewJavascriptBridge(a){if(window.WebViewJavascriptBridge){return a(WebViewJavascriptBridge)}if(window.WVJBCallbacks){return window.WVJBCallbacks.push(a)}window.WVJBCallbacks=[a];var b=document.createElement('iframe');b.style.display='none';b.src='wvjbscheme://__BRIDGE_LOADED__';document.documentElement.appendChild(b);setTimeout(function(){document.documentElement.removeChild(b)},0)}function GetIndexIcon(s){$.ajax({type:"get",url:"https://api.baoluo.com/v4/mallIndex",dateType:"json",headers:{'Authorization':'Bearer '+s},success:function(b){var d=b.AdList[0].ImgUri;var e=b.AdList[1].ImgUri;var f='<img style="width:100%;height:100%;" src="'+d+'" />';$('.BannersImg0').append(f);var g='<img style="width:100%;height:100%;" src="'+e+'" />';$('.BannersImg1').append(g);var h=b.ProductList;var s=((h.length)/2-1);var i=s.toString();if($('.ProListName').length!==h.length){for(var c=0;c<s;c++){$('#goods-show').append($('.goosd-line').eq(0).clone())}}else{return false}for(var a=0;a<h.length;a++){var j=h[a].ProductIcon;var k=h[a].ProductName;var l=h[a].ProductPrice;var m=h[a].StockQuantity;var n=h[a].ProductId;$('.ProListImg').eq(a).attr('src',j);$('.ProListName').eq(a).html(k);$('.ProListPrice').eq(a).html(l);$('.ProListQuantity').eq(a).html(m);$('.IndexHref').eq(a).attr('href','ProductPageList.html?MZ='+n)}},error:function(a){var b=a.responseText;console.log(b)}})};function GetPointLotteryList(s){$.ajax({type:"get",url:"https://api.baoluo.com/api/pointLotteryList",dateType:"json",headers:{'Authorization':'Bearer '+s},success:function(a){var b=a.Items;if(b.length==0){$('#pro-show').hide()}$('.pro-show-li-box').hide();for(i=0;i<b.length;i++){$('.pro-show-li-box').eq(i).show()}for(var i=0;i<b.length;i++){var c=b[i].Icon;var d=b[i].Name;var e=b[i].PointLotteryId;var f=b[0].Phase;var g=b[i].JoinNum;var h=b[i].UserNum;var s=h-g;var j=((g/h)*7+0.5).toString();$('.ProPointImg').eq(i).attr('src',c);$('.proname').eq(i).html(d);$('.IndexPointHref').eq(i).attr('href','ProductPageCont.html?MZ='+e);$('.historynumber').html('第'+f+'期');$('.IndexJoinNum').eq(i).html(h);$('.IndexUserNum').eq(i).html(s);$('.test').eq(i).css('width',j+'rem')}},error:function(a){var b=a.responseText;console.log(b)}})};function GetToken(c,d,e){var f="";$.ajax({url:'https://api.baoluo.com/home/GetToken',data:JSON.stringify({ClientId:e,UserName:c,PassWord:d,}),dateType:"json",type:"Post",async:false,headers:{'Content-Type':'application/json'},success:function(a){var b=eval('('+a+')');f=b.access_token;return f},error:function(a){var b=a.responseText;console.log(b)}});return f};